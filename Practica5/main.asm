;
; Practica5.asm
;
; Created: 19/06/2020 05:10:37 p. m.
; Author : Luis Nogal
;


; Replace with your application code
.ORG 0X00
JMP RESET
.ORG 0X1C
JMP TIM0_COMPA
RESET:
	LDI R16, 0X40
	STS ADMUX, R16	//CONFIGURACION ADC 5V INTERNO
	LDI R16, 0XFF
	OUT DDRD, R16
	OUT DDRB, R16
	LDI R16, 0X07
	STS ADCSRA, R16
	LDI R16, 0X01
	STS DIDR0, R16 
	ldi r16, high(RAMEND); Main program start     
	out SPH,r16 ; Set Stack Pointer to top of RAM     
	ldi r16, low(RAMEND)     
	out SPL,r16
	SEI
    ldi r22,0x00    //COM0B1, WGM01, WGM00
    out TCCR0A,r22  // 00100011
    ldi r22,0x05     //WGM02, CS00 00001011
    out TCCR0B,r22   //
	LDI R16, 100
	OUT OCR0A, R16
	LDI R16, 0X02
	STS TIMSK0, R16

CONVER: //Compuerta OR
	CLR r24
	LDI R17, 0b11000000
	LDS R18, ADCSRA
	OR R18, R17
	STS ADCSRA, R18

ADCDATA:
	LDS R17, ADCSRA	//LEER VALORES ANALOGICOS
	SBRS R17, 4		//CHECA SI LA CONVESION YA SE COMPLETO (ADIF - bit #4)
	RJMP ADCDATA	
	LDS R18, ADCL	//SI LA CONVERSION YA SE COMPLETO, LEEMOS EL DATO EN ADCL
	LDS R19, ADCH   //SI LA CONVERSION YA SE COMPLETO, LEEMOS EL DATO EN ADCL
	//-------------- Multiplicar por 5
	LDI r20, 0x05 ;Factor
	MUL r18, r20
	MOV r22, r0
	MOV r3, r1
	MUL r20, r19
	ADD r3, r0
	MOV r23, r3
	LDI r20, 0xE8
	LDI r21, 0x03
		//----------------	División
DIV:
	MOVW r2, r22; NUMERADORES
	MOVW r4, r20; DENOMINADORES
	CLR r0
	CLR r1
	CLR r8
	LDI r25, 0x01
	COUNT:
		SUB r2, r4	
		SBC r3, r5
		BRLT OK
		CP r3, r5
		ADD r0, r25
		BRCS INCREMENTARR1
		RJMP TESTR3
	INCREMENTARR1:
		INC R1
		RJMP TESTR3
	TESTR3:
		TST r3
		BREQ TESTR2
		MOVW r6,r2		
		SUB r6, r4	
		SBC r7, r5
		SBC r8,r8
		BRLT OK
		RJMP COUNT
	TESTR2:
		TST r2
		BREQ OK
		MOVW r6,r2		
		SUB r6, r4	
		SBC r7, r5
		SBC r8,r8
		BRLT OK
		RJMP COUNT
	OK:	
		TST R0
		BREQ CERO2
		MOV R27, R0
		CPI R27, 0X01
		BREQ UNO2
		MOV R27, R0
		CPI R27, 0X02
		BREQ DOS2
		MOV R27, R0
		CPI R27, 0X03
		BREQ TRES2
		MOV R27, R0
		CPI R27, 0X04
		BREQ CUATRO2
		MOV R27, R0
		CPI R27, 0X05
		BREQ CINCO2
		MOV R27, R0
		CPI R27, 0X06
		BREQ SEIS2
		MOV R27, R0
		CPI R27, 0X07
		BREQ SIETE2
		MOV R27, R0
		CPI R27, 0X08
		BREQ OCHO2
		MOV R27, R0
		CPI R27, 0X09
		BREQ NUEVE2
OUTPUT:	
		ADD R24, R25
		MOV R26, R24
		CPI R26, 0X01
		BREQ CIEN
		MOV R26, R24
		CPI R26, 0X02
		BREQ DIEZ
		CPI R26, 0X03
		BREQ UNIDAD
SETDEN:	
		CPI R26, 0X04
		BREQ CON		
		MOVW R22, R2
		RJMP DIV	

QPUNTO:	
		TST r24
		BREQ PUNTO
		RJMP OUTPUT
CON:	
		MOV R12, R22
		RJMP CONVER
CERO2:
		RJMP CERO
UNO2:
		RJMP UNO
DOS2:
		RJMP DOS
TRES2:
		RJMP TRES
CUATRO2:
		RJMP CUATRO
CINCO2:
		RJMP CINCO
SEIS2:
		RJMP SEIS
SIETE2:
		RJMP SIETE
OCHO2:
		RJMP OCHO
NUEVE2:
		RJMP NUEVE
CIEN:	
		CLR R21
		LDI R20, 0X64
		MOV R9, R22
		RJMP SETDEN
DIEZ:	
		CLR R21
		LDI R20, 0X0A
		MOV R10, R22
		RJMP SETDEN
UNIDAD:	
		CLR R21
		LDI R20, 0X01
		MOV R11, R22
		RJMP SETDEN
PUNTO:	
		ADD R22, R25
		RJMP OUTPUT
CERO:	
		LDI r22, 0xFC
		RJMP QPUNTO
UNO:	
		LDI r22, 0x60
		RJMP QPUNTO
DOS:	
		LDI r22, 0xDA
		RJMP QPUNTO
TRES:	
		LDI r22, 0xF2
		RJMP QPUNTO
CUATRO:	
		LDI r22, 0x66
		RJMP QPUNTO
CINCO:	
		LDI r22, 0xB6
		RJMP QPUNTO
SEIS:	
		LDI r22, 0xBE
		RJMP QPUNTO
SIETE:	
		LDI r22, 0xE0
		RJMP QPUNTO
OCHO:	
		LDI r22, 0xFE
		RJMP QPUNTO
NUEVE:	
		LDI r22, 0xEE
		RJMP QPUNTO

TIM0_COMPA:
	CPI R28, 0X00
	BREQ PRINT1
	CPI R28, 0X01
	BREQ PRINT2
	CPI R28, 0X02
	BREQ PRINT3
	CPI R28, 0X03
	BREQ PRINT4
EXIT:
	RETI
PRINT1:
		OUT portd, r9
		OUT portb, r28
		INC R28
		RJMP EXIT
PRINT2:
		OUT portd, r10
		OUT portb, r28
		INC R28
		RJMP EXIT
PRINT3:
		OUT portd, r11
		OUT portb, r28
		INC R28
		RJMP EXIT
PRINT4:
		OUT portd, r12
		OUT portb, r28
		CLR R28
		RJMP EXIT